<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="http://jacob.thebault-spieker.com/theme/css/stylesheet.css" />
  <title>Jacob Thebault-Spieker</title>
  <!-- <link href="http://jacob.thebault-spieker.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jacob Thebault-Spieker Atom Feed" /> -->

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet / Stamen -->
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

  <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.4"></script>

  <!-- JQuery -->
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  <!-- Font Awesome -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

</head>
<body>
  <div id="map" class="map" style="z-index: -6;"></div>
  <div class="map-overlay" style="z-index: -4;"></div>
  <div class="container-fluid" style="padding: 0;">
    <!-- <div class="row row-no-padding"> -->
      <!-- <div class="col-md-offset-1 col-md-4" style="margin-right: 0px !important;"> -->
        <div id="header" class="box-no-padding affix" style="min-width: 200px; float: left; margin-right: 0; width: 25%; margin-left: 5%; padding-right: 0;">
          <div style="display: inline;">
            <button type="button" class="add-padding links-toggle" data-toggle="collapse" data-target="#header .toggle">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <img class="img-responsive img-circle" style='margin-top: 20px; padding-left: 50px; padding-right: 50px;' src="http://jacob.thebault-spieker.com/theme/images/profile_pic.jpg" alt="Photo of Jacob">
          <h2 class='name'>Jacob</h2>
          <h2 class='name'>Thebault-Spieker</h2>
          <div class="toggle collapse">
            <ul id='sidebar' class="no-bullet">
              <li id="home"><a href="/">Home</a></li>
              <li id="about"><a href="/about.html">About</a></li>
              <li id="papers"><a href="/papers.html">Papers</a></li>
              <li id="ephemera"><a href="/ephemera.html">Ephemera</a></li>
              <li id='cv'><a href="files/CV.pdf" target="blank">CV&nbsp;<i class="fa fa-file-pdf-o"></i></a></li>
            </ul>
            <div style="margin-left: auto; margin-right: auto; text-align: center;">
              <div class="social add-padding">
                <h3>Feeds & Inboxes</h3>
                <a href="https://twitter.com/jts__"><i class="fa fa-twitter fa-2x"></i></a>
                <a href="http://jacob.thebault-spieker.com/feeds/all.atom.xml"><i class="fa fa-rss fa-2x" aria-hidden="true"></i></a>
                <!-- below is <a href="mailto:your@email.here"><i class="fa fa-envelope fa-2x"></i></a>, through http://hivelogic.com/enkoder/ Advanced form -->
                &nbsp; <script type="text/javascript">
                //<![CDATA[
                <!--
                var x="function f(x){var i,o=\"\",l=x.length;for(i=0;i<l;i+=2) {if(i+1<l)o+=" +
                "x.charAt(i+1);try{o+=x.charAt(i);}catch(e){}}return o;}f(\"ufcnitnof x({)av" +
                " r,i=o\\\"\\\"o,=l.xelgnhtl,o=;lhwli(e.xhcraoCedtAl(1/)3=!84{)rt{y+xx=l;=+;" +
                "lc}tahce({)}}of(r=i-l;1>i0=i;--{)+ox=c.ahAr(t)i};erutnro s.buts(r,0lo;)f}\\" +
                "\"(0)\\\\,P\\\"RZEA10\\\\09\\\\26\\\\0?\\\\\\\\\\\\\\\\\\\\00\\\\0O\\\\`cs4" +
                "dg4{00\\\\\\\\d/5xr5 4\\\\ \\\\\\\"(\\\\%:d/!)$f\\\"\\\\\\\\\\\\6a03\\\\\\\\"+
                "3|_L_Q33\\\\0S\\\\05\\\\06\\\\00\\\\\\\\25\\\\0j\\\\P@4V03\\\\\\\\]_0Z00\\\\"+
                "\\\\O^^k]EDFL@0W03\\\\\\\\TNwsq|F9~$dr4}.r83baxhxb&~hsi`avdn\\\"\\\\f(;} or" +
                "nture;}))++(y)^(iAtdeCoarchx.e(odrChamCro.fngriSt+=;o27=1y%i;+=)y=0i=f({i+)" +
                "i+l;i<0;i=r(foh;gten.l=x,l\\\"\\\\\\\"\\\\o=i,r va){,y(x fontincfu)\\\"\")"  ;
                while(x=eval(x));
                //-->
                //]]>
                </script>
              </div>
            </div>
          </div>
        </div>
      <!-- </div> -->
      <div class="lightbox add-padding" style="margin-top: 50px; float: left; width: 65%; margin-left: 30%; height: 100%;">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://jacob.thebault-spieker.com/ephemera/2016/01/26/iron-blogging-simplifying-workflows/" rel="bookmark"
         title="Permalink to Iron Blogging - Simplifying Workflows">Iron Blogging - Simplifying Workflows</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2016-01-26T00:00:00-06:00">
      Tue 26 January 2016
    </abbr>
    <abbr class="modified" title="2016-01-26T00:00:00-06:00">
      Tue 26 January 2016
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="http://jacob.thebault-spieker.com/author/jacob-thebault-spieker.html">Jacob Thebault-Spieker</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <blockquote>
<p><em>This post is a part of the GroupLens Iron Blogging effort, so take that for what you will.</em></p>
</blockquote>
<p>I do a fair amount of spatial data analysis, particularly in the space of trying to understand geographic disparity, and its effects on systems.</p>
<p>This workflow used to go something like:</p>
<ol>
<li>Setup a <a href="http://www.postgresql.org">Postgresql</a>/<a href="http://postgis.net">PostGIS</a> database</li>
<li>import all the data (including points or polygons that reflect geographic regions)<ul>
<li>this often involves replicating geometries because there are individual data points that apply to the same geometry</li>
</ul>
</li>
<li>do any aggregation or summary statistics <em>per geometry</em> that I needed to do, and apply these values to each Postgres record</li>
<li>use <code>pgsql2shp</code> command, to dump a database table (or a subset of the table, by query) to get a <a href="https://en.wikipedia.org/wiki/Shapefile">shapefile</a><ul>
<li>this often involves at least one <code>GROUP BY</code> clause</li>
</ul>
</li>
<li>Open this shapefile in <a href="http://qgis.org/en/site/">QGIS</a>, to do some exploratory mapping, and save the data as a CSV file for later</li>
<li>Open this shapefile in <a href="https://geodacenter.asu.edu/software/downloads">GeoDa</a>, to do some simple exploratory analysis</li>
<li>Import the aforementiond CSV file into R, and then write R code to do any data transformation needed</li>
<li>Use R for any analysis (normally spatial regressions, with <code>spdep</code>)</li>
</ol>
<p>You'll notice here, that around step 7, we lose any concept of the geometry of this geographic data. Unfortunately, this means that if I any of the things below, that I need to start again at Step 3:</p>
<ul>
<li>a different geographic subset of the data for analysis, or</li>
<li>a different geographic function (say, population density), or</li>
<li>anything at the R stage that isn't already there</li>
</ul>
<p>There is a better world.</p>
<p>For a different project, I recently started using <a href="http://Jupyter.org">Jupyter</a>, for easier collaboration.</p>
<p>At first, it was nice, because I could just import CSVs into Jupyter, and use <em>Python</em> (specifically pandas, which is incredibly nice) for the data transformation. This is better for me than R. However, I quickly started wondering if there is a way insert Jupyter and python earlier into my workflow.</p>
<p>As it turns out, a lot of the geographic analysis software (QGIS, GeoDa, steps 5 and 6 respectively) is built on top of existing python libraries. That's a good sign, but it made me worry I'd have to drop down a level and code more, which would be a time sink. Enter: <a href="http://geopandas.org">GeoPandas</a>.</p>
<p>GeoPandas, or geographic extension to <a href="http://pandas.pydata.org">Pandas</a>, is a whole new game. GeoPandas lets me load a GeoDataFrame (you know, a DataFrame, with <em>geography</em>) either from a shapefile (we're now at step 4), or even better <em>directly from PostGIS</em>.</p>
<p>Because Pandas (and subsequently GeoPandas) has such nice <code>groupby()</code> and <code>agg()</code> functionality, I don't need to write these things in SQL. Because GeoPandas also has a concept of geometric operations (point in polygon, intersection, etc.) and <em>spatial joins</em> (merging datasets based on geographic overlap) I can insert the Python/Jupyter workflow <em>after Step 2</em>.</p>
<p>I mentioned before that a lot of the geographic analysis software was built on python libraries. As it turns out, GeoDa is built on top of a library called <a href="https://geodacenter.asu.edu/pysal">pysal</a>. This means that I can do any analysis supported by GeoDa (including spatial regressions) directly from python.</p>
<p>My workflow now looks like:</p>
<ol>
<li>Setup a Postgresql/PostGIS database</li>
<li>import all the data (including points or polygons that reflect geographic regions)<ul>
<li>this often involves replicating geometries because there are individual data points that apply to the same geometry</li>
</ul>
</li>
<li>Load this table into Jupyter (with GeoPandas), and perform any aggregation, summary statistics, or data transformation I need, which either become a new column, or perhaps a transformed GeoDataFrame (remember <code>groupby()</code>?)</li>
<li>Do any exploratory mapping, exploratory analysis, or more involved spatial analysis <em>directly within Jupyter</em>.</li>
</ol>
<p>So, I've now cut the number of different steps in half, and dropped the number of different ways I work with this data (including different languages used) from 5 to 1 (or maybe 2, if you count the single line of SQL I'm writing to dump data out of my database).</p>
<p>I've long resisted Python, because I know Java or Javascript, and it wasn't clear what Python got me.</p>
<p>I was so wrong.</p>
  </div><!-- /.entry-content -->
</section>
      </div>
    <!-- </div> -->
  </div>
</body>
<script type="text/javascript">
var layer = new L.StamenTileLayer("watercolor");
var map = new L.Map("map", {
  center: new L.LatLng(44.95, -93.1),
  zoom: 11,
  dragging: false,
  doubleClickZoom: false,
  scrollWheelZoom: false,
  boxZoom: false,
  keyboard: false,
  zoomControl: false,
  attributionControl: false
});
map.addLayer(layer);

current = '';
applied = false;
$( document ).ready(function() {
  $("#index").addClass('active');
  $("#sidebar").children().each(function(e) {
    if(applied) {
      return;
    }

    var id = $(this).attr('id');

    if (window.location.href.indexOf(id) != -1) {
      $("#"+id).addClass('active')
      applied = true;
    } else {
      $("#"+id).removeClass('active')
      applied = false;
    }
  })

  if(!applied) {
      $("#home").addClass('active')
  }
})

// $('#header').affix({
//   offset: {
//     top: 50
//   }
// });

</script>