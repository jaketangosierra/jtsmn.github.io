<!DOCTYPE html>
<html lang="en">
<head>
  <script src="../../../../../theme/js/js.js"> </script>
  <link rel="stylesheet" href="../../../../../theme/css/stylesheet.css" />
  <title>Jacob Thebault-Spieker</title>
  <!-- <link href="http://jtsmn.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jacob Thebault-Spieker Atom Feed" /> -->

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet / Stamen -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.7/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@0.7.7/dist/leaflet.js"></script>

  <!-- JQuery -->
  <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> 

  <!-- Font Awesome -->
  <script defer src="https://use.fontawesome.com/releases/v5.0.4/js/all.js"></script>
  <!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"> -->

</head>
<body>
  <!-- https://www.sessions.edu/color-calculator-results/?colors=f07800,7800f0,00f0f0 -->
  <div id='map' style='position: fixed; width: 100vw; height: 100vh; z-index: -1000;'> </div>
  <div style='position: fixed; width: 100vw; height: 100vh; background-color: rgba(255,255,255, 0.6); z-index: -500;'></div>

  <script>
    var map = L.map('map', {zoomControl: false, attributionControl: false}).setView([37.13, -80.25], 11);
    L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png').addTo(map);
  </script>

  <nav class='navbar fixed-top navbar-color navbar-toggleable-md'>
      <div class='navbar-brand name'>
        Jacob Thebault-Spieker
        <a href="https://twitter.com/jts__"><i class="fab fa-twitter fa-lg"></i></a>
        <a href="http://jacob.thebault-spieker.com/feeds/all.atom.xml"><i class="fas fa-rss fa-lg"></i></a>
        <!-- below is <a href="mailto:your@email.here"><i class="fa fa-envelope fa-2x"></i></a>, through http://hivelogic.com/enkoder/ Advanced form -->
        <script type="text/javascript">
          while(xh=eval(xh)); 
        </script>
      </div>
      <div class='navbar-text'>
        <a style='line-height: 0.75em' id='home' href="/">Home</a>&nbsp;|&nbsp;
        <a style='line-height: 0.75em' id='papers' href="/papers.html">Papers</a>&nbsp;|&nbsp;
        <a style='line-height: 0.75em' id='ephemera' href="/ephemera.html">Ephemera</a>&nbsp;|&nbsp;
        <a id='cv' href="/curriculum-vitae.html" target="blank">Curriculum Vitae&nbsp;<i class="fas fa-external-link-alt"></i></a></li>
        <a href='/cv.pdf' target="blank">&nbsp;<i class="fas fa-file-pdf"></i></a>
      </div>

  </nav>
  <div id='sidebar' style='min-height: 100% !important; position: fixed; color: #000;' class='col-md-3 sidebar'>
    <br><h3> News & Updates </h3>
    <div class='add-padding'>
      <ul>
        <li class='news'> <strong>Jan. 2018</strong>&nbsp;Moved to Blacksburg, VA to start a postdoc position in the Crowd Intelligence Lab at VT with Kurt Luther! </li>
        <li class='news'> <strong>Dec. 2017</strong>&nbsp;I successfully defended my dissertation! </li>
        <li class='news'> <strong>Oct. 2017</strong>&nbsp;My first author paper <em>Geographic Biases are ‘Born, not Made’: Exploring Contributors’ Spatiotemporal Behavior in OpenStreetMap</em> was accepted to GROUP 2018! </li>
        <li class='news'> <strong>Sept. 2017</strong>&nbsp;Sucessfully passed my Thesis Proposal! </li>
      </ul>
    </div>
  </div>
  <div class='container-fluid' style='margin-top: 65px; padding-left: 0 !important; padding-right: 0 !important'>
     <div class='col-md-3' style='visibility: hidden;'></div>
      <div id='body' class='col-md-9 add-padding' style='min-height: 100vh !important; color: #000;'>
        <div class='col-md-10'>
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="../../../../../ephemera/2016/01/26/iron-blogging-simplifying-workflows/" rel="bookmark"
         title="Permalink to Iron Blogging - Simplifying Workflows">Iron Blogging - Simplifying Workflows</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2016-01-26T00:00:00-05:00">
      Tue 26 January 2016
    </time>
    <time class="modified" datetime="2016-01-26T00:00:00-05:00">
      Tue 26 January 2016
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="../../../../../author/jacob-thebault-spieker.html">Jacob Thebault-Spieker</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <blockquote>
<p><em>This post is a part of the GroupLens Iron Blogging effort, so take that for what you will.</em></p>
</blockquote>
<p>I do a fair amount of spatial data analysis, particularly in the space of trying to understand geographic disparity, and its effects on systems.</p>
<p>This workflow used to go something like:</p>
<ol type="1">
<li>Setup a <a href="http://www.postgresql.org">Postgresql</a>/<a href="http://postgis.net">PostGIS</a> database</li>
<li>import all the data (including points or polygons that reflect geographic regions)
<ul>
<li>this often involves replicating geometries because there are individual data points that apply to the same geometry</li>
</ul></li>
<li>do any aggregation or summary statistics <em>per geometry</em> that I needed to do, and apply these values to each Postgres record</li>
<li>use <code>pgsql2shp</code> command, to dump a database table (or a subset of the table, by query) to get a <a href="https://en.wikipedia.org/wiki/Shapefile">shapefile</a>
<ul>
<li>this often involves at least one <code>GROUP BY</code> clause</li>
</ul></li>
<li>Open this shapefile in <a href="http://qgis.org/en/site/">QGIS</a>, to do some exploratory mapping, and save the data as a CSV file for later</li>
<li>Open this shapefile in <a href="https://geodacenter.asu.edu/software/downloads">GeoDa</a>, to do some simple exploratory analysis</li>
<li>Import the aforementiond CSV file into R, and then write R code to do any data transformation needed</li>
<li>Use R for any analysis (normally spatial regressions, with <code>spdep</code>)</li>
</ol>
<p>You’ll notice here, that around step 7, we lose any concept of the geometry of this geographic data. Unfortunately, this means that if I any of the things below, that I need to start again at Step 3:</p>
<ul>
<li>a different geographic subset of the data for analysis, or</li>
<li>a different geographic function (say, population density), or</li>
<li>anything at the R stage that isn’t already there</li>
</ul>
<p>There is a better world.</p>
<p>For a different project, I recently started using <a href="http://Jupyter.org">Jupyter</a>, for easier collaboration.</p>
<p>At first, it was nice, because I could just import CSVs into Jupyter, and use <em>Python</em> (specifically pandas, which is incredibly nice) for the data transformation. This is better for me than R. However, I quickly started wondering if there is a way insert Jupyter and python earlier into my workflow.</p>
<p>As it turns out, a lot of the geographic analysis software (QGIS, GeoDa, steps 5 and 6 respectively) is built on top of existing python libraries. That’s a good sign, but it made me worry I’d have to drop down a level and code more, which would be a time sink. Enter: <a href="http://geopandas.org">GeoPandas</a>.</p>
<p>GeoPandas, or geographic extension to <a href="http://pandas.pydata.org">Pandas</a>, is a whole new game. GeoPandas lets me load a GeoDataFrame (you know, a DataFrame, with <em>geography</em>) either from a shapefile (we’re now at step 4), or even better <em>directly from PostGIS</em>.</p>
<p>Because Pandas (and subsequently GeoPandas) has such nice <code>groupby()</code> and <code>agg()</code> functionality, I don’t need to write these things in SQL. Because GeoPandas also has a concept of geometric operations (point in polygon, intersection, etc.) and <em>spatial joins</em> (merging datasets based on geographic overlap) I can insert the Python/Jupyter workflow <em>after Step 2</em>.</p>
<p>I mentioned before that a lot of the geographic analysis software was built on python libraries. As it turns out, GeoDa is built on top of a library called <a href="https://geodacenter.asu.edu/pysal">pysal</a>. This means that I can do any analysis supported by GeoDa (including spatial regressions) directly from python.</p>
<p>My workflow now looks like:</p>
<ol type="1">
<li>Setup a Postgresql/PostGIS database</li>
<li>import all the data (including points or polygons that reflect geographic regions)
<ul>
<li>this often involves replicating geometries because there are individual data points that apply to the same geometry</li>
</ul></li>
<li>Load this table into Jupyter (with GeoPandas), and perform any aggregation, summary statistics, or data transformation I need, which either become a new column, or perhaps a transformed GeoDataFrame (remember <code>groupby()</code>?)</li>
<li>Do any exploratory mapping, exploratory analysis, or more involved spatial analysis <em>directly within Jupyter</em>.</li>
</ol>
<p>So, I’ve now cut the number of different steps in half, and dropped the number of different ways I work with this data (including different languages used) from 5 to 1 (or maybe 2, if you count the single line of SQL I’m writing to dump data out of my database).</p>
<p>I’ve long resisted Python, because I know Java or Javascript, and it wasn’t clear what Python got me.</p>
<p>I was so wrong.</p>

  </div><!-- /.entry-content -->
</section>
        </div>
      </div>
  </div>
</body>